<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="list">


	<select id="studentLimit" parameterType="PassDTO"	resultType="Integer">

		SELECT APPL_NUM
		FROM CRCLM_INFO
		WHERE CRCLM_CD = #{CRCLM_CD} AND RECRT_SCHDL_CD =#{RECRT_SCHDL_CD} AND RECRT_YEAR=#{RECRT_YEAR};

	</select>
	
	<select id="studentList" parameterType="PassDTO"
		resultType="PassDTO">

		SELECT *
		FROM APPL_INFO
		WHERE PASS_INFO  <![CDATA[<]]> 3 
		AND CRCLM_CD = #{CRCLM_CD} AND RECRT_SCHDL_CD =#{RECRT_SCHDL_CD} AND
		(passed="합격" or passed="서류합격" ) AND RECRT_YEAR=#{RECRT_YEAR} AND 
		KORN_FLNM LIKE CONCAT('%', #{KORN_FLNM}, '%')
		ORDER BY avg DESC

	</select>
	<update id="Passupdate" parameterType="PassDTO">
		UPDATE APPL_INFO
		SET
		PASS_INFO=#{PASS_INFO}
		WHERE appl_NO=#{appl_NO}

	</update>
	<select id="result" resultType="int" parameterType="PassDTO">
		SELECT
		PASS_INFO
		FROM APPL_INFO
		WHERE appl_NO=#{appl_NO};
	</select>
	<select id="department" resultType="PassDTO">
		SELECT DISTINCT DEPARTMENT,CRCLM_CD
		FROM CRCLM_INFO
	</select>
	<select id="categoryList" resultType="PassDTO">
		SELECT RECRT_YEAR
		FROM RECRT_SCHDL
		GROUP BY RECRT_YEAR
		ORDER BY RECRT_YEAR DESC
	</select>
	
	<select id="studentValue" parameterType="PassDTO" resultType="PassDTO">
		SELECT * FROM APPL_INFO WHERE appl_NO = #{appl_NO}
	</select>
	
	<insert id="studentSubmit1" parameterType="PassDTO">
	INSERT INTO STUD_INFO (Student_ID,appl_NO,KORN_FLNM,USER_BRDT,GENDER_CD,
    AGE,TELNO,REL_TELNO, REL_CD,  EML_ADDR,  ZIP, ADDR, DADDR, USER_NO,CRCLM,CRCLM_CYCL,
    PASS_INFO, category, avg, passed, department
)
VALUES (
    CONCAT(RIGHT(YEAR(CURRENT_DATE()), 2), '000000', LAST_INSERT_ID() + 1),
    #{appl_NO}, #{KORN_FLNM}, #{USER_BRDT},  #{GENDER_CD},  #{AGE},  #{TELNO},  #{REL_TELNO},
    #{REL_CD},  #{EML_ADDR},  #{ZIP},  #{ADDR},  #{DADDR},  #{USER_NO},  #{CRCLM},
    #{CRCLM_CYCL},  #{PASS_INFO},  #{category},  #{avg},  #{passed},  #{department}
)
	</insert> 
</mapper>
